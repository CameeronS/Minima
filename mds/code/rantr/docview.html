<html>

<head>
	<title>CHATTER</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="text/javascript" src="mds.js"></script>
	<script type="text/javascript" src="rant.js"></script>
</head>

<body>

<center>

	<br>

	<h2>CHAT</h2>

<script type="text/javascript">

	var replytree;
	function walkchat(chatrow, depth){
		//MDS.log(JSON.stringify(chatrow));
		var user 	= chatrow.USERNAME;
		var message	= decodeURIComponent(chatrow.MESSAGE);
		var link 	= "&nbsp;<a href='reply.html?uid="+MDS.minidappuid+"&msgid="+chatrow.MSGID+"'>REPLY</a>"
		
		replytree.innerHTML += new Array(depth).join('&nbsp;&nbsp;&nbsp;&nbsp;')+user+" : "+message+link+"<br><br>";
		
		//Now walk through the replies..
		var len = chatrow.replies.length;
		for(var i=0;i<len;i++){
			var reply = chatrow.replies[i];
			walkchat(reply, depth+1)
		}
	}

	//Main message handler..
	MDS.init(function(msg){
		
		//Do initialisation
		if(msg.event == "inited"){
			
			//What RANT is this..
			var baseid = MDS.form.getParams("baseid");
			
			//Load it up..
			var tree = createReplyTable(baseid,function(treemsg){
				//MDS.log(JSON.stringify(treemsg,null,2));
				replytree = document.getElementById("replytree");
				walkchat(treemsg.toprant,1);
			});			
		}
	});
		
</script>

<div id="replytree" style="text-align:left;width:500"></div>

</center>
</body>
</html>