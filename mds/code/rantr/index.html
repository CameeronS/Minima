<html>

<head>
	<title>CHATTER</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script type="text/javascript" src="mds.js"></script>
	<script type="text/javascript" src="rant.js"></script>
</head>

<body>

<center>
	<br>
	<h2>CHATTER</h2>
	
	<div id=userdetails></div>
	<br>
	<textarea rows="4" cols="60" name="rant" id="mainmessage"></textarea>
	<br>
	<br>
	<button onclick="sendRant();">Make a Rant</button>

<br>
<br>
	<table id="mainranttable" border=1 style="width: 600">
		<tr>
			<th>NAME</th>
			<th>MESSAGE</th>
			<th>DATE</th>
			<th>REPLIES</th>
			<th>ACTIONS</th>
		</tr>
	</table>
	
</center>

<script type="text/javascript">
	
	//Main message handler..
	MDS.init(function(msg){
		
		//Do initialisation
		if(msg.event == "inited"){
			
			//Run Maxima to get the User details..
			MDS.cmd("maxima",function(msg){
				MAXIMA_PUBLICKEY = msg.response.publickey;
				MAXIMA_USERNAME  = msg.response.name;
				MAXIMA_CONTACT	 = msg.response.contact;
				
				var userdets = document.getElementById("userdetails");
				userdets.innerHTML = MAXIMA_USERNAME; 
			});
			
			//MDS.sql("DROP table messages");
			//return;
			
			//Are we deleting..
			var del 	= MDS.form.getParams("delete");
			var baseid 	= MDS.form.getParams("baseid");
			if(del){
				//Delete the whole thread..
				deleteBaseID(baseid,function(){
					createMainTable();
				});
				
			}else{
				//Load the table..
				createMainTable();	
			}
		}
	});

	function sendRant(){
		//Get the Text..
		var text = document.getElementById("mainmessage").value;
		document.getElementById("mainmessage").value = "";
		if(text.trim() == ""){
			return;
		}
		
		//Create the Chatter message
		createRant(text,"0x00","0x00",function(rant){
			
			//ok - now add this message to OUR DB
			addRantToDB(rant,function(){
				
				//And post over Maxima
				postRant(rant)
				
				//And reload the main table
				createMainTable();	
			});
		});
	}
	
</script>

</body>
</html>